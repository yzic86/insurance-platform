<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>保险宣传平台 - 新闻详情</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: "微软雅黑", sans-serif; }
    /* 导航栏样式 */
    .nav { height: 60px; background: #0066cc; display: flex; align-items: center; padding: 0 50px; flex-wrap: wrap; }
    .nav .logo { color: white; font-size: 20px; font-weight: bold; margin-right: 50px; }
    .nav a { color: white; text-decoration: none; margin: 0 20px; font-size: 16px; }
    /* 主体容器 */
    .container { padding: 30px 50px; max-width: 1200px; margin: 0 auto; }
    .breadcrumb { font-size: 14px; color: #999; margin-bottom: 20px; }
    .breadcrumb a { color: #0066cc; text-decoration: none; }
    /* 新闻详情样式 */
    .news-detail { background: white; padding: 30px; border-radius: 5px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 30px; }
    .news-title { font-size: 24px; color: #333; margin-bottom: 20px; text-align: center; }
    .news-info { text-align: center; color: #999; font-size: 14px; margin-bottom: 30px; padding-bottom: 15px; border-bottom: 1px solid #eee; }
    .news-info span { margin: 0 10px; }
    /* 阅读量样式：橙色突出显示 */
    .read-count { color: #ff6700; font-weight: bold; }
    .coop-contact { color: #e63946; font-weight: bold; }
    .news-content { line-height: 1.8; color: #333; font-size: 16px; }
    .news-content img { max-width: 100%; margin: 15px 0; border-radius: 5px; }
    .attachment { margin-top: 30px; padding: 15px; background: #f5f5f5; border-radius: 5px; }
    .attachment a { color: #0066cc; text-decoration: none; }
    /* 相关推荐样式 */
    .related-news h3 { margin-bottom: 20px; color: #333; border-left: 4px solid #0066cc; padding-left: 10px; }
    .related-list { display: flex; flex-wrap: wrap; gap: 20px; justify-content: center; }
    .related-item { width: 300px; padding: 15px; border: 1px solid #eee; border-radius: 5px; }
    .related-item h4 { margin-bottom: 10px; }
    .related-item h4 a { color: #333; text-decoration: none; }
    .related-item .info { font-size: 12px; color: #999; }
    /* 空数据样式 */
    .empty { text-align: center; padding: 50px; color: #999; }
    /* 底部样式 */
    .footer { background: #333; color: white; padding: 30px 50px; margin-top: 30px; }
    .footer .contact { margin-bottom: 20px; }
    .footer .copyright { font-size: 12px; color: #999; }

    /* 响应式适配 */
    @media (max-width: 768px) {
      .nav { padding: 0 20px; }
      .nav .logo { margin-right: 20px; }
      .nav a { margin: 0 10px; }
      .container { padding: 20px; }
      .news-title { font-size: 20px; }
      .related-item { width: 100%; }
    }
  </style>
</head>
<body>
  <!-- 导航栏 -->
  <div class="nav">
    <div class="logo">保媒+</div>
    <a href="index.html">首页</a>
    <a href="companies.html">公司介绍</a>
    <a href="news.html">新闻中心</a>
    <a href="contact.html">联系方式</a>
  </div>

  <!-- 新闻详情主体 -->
  <div class="container">
    <div class="breadcrumb">
      <a href="index.html">首页</a> > <a href="news.html">新闻中心</a> > <span id="newsTitle">加载中...</span>
    </div>

    <!-- 新闻详情 -->
    <div class="news-detail" id="newsDetail">
      <!-- 新闻详情由JS渲染 -->
    </div>

    <!-- 相关推荐 -->
    <div class="related-news" id="relatedNews">
      <!-- 相关推荐由JS渲染 -->
    </div>
  </div>

  <!-- 底部 -->
  <div class="footer">
    <div class="contact">
      <p><strong>保险让生活更美好</strong></p>
      <p>平台仅提供宣传内容展示，合作事宜请直接联系对应保险公司</p>
    </div>
    <!-- <div class="copyright">© 2025 保险宣传平台 版权所有 | 隐私政策 | 免责声明</div> -->
  </div>

  <script src="data.js"></script>
  <script>
    // 生成 [1, n] 范围内的随机整数
    function getRandomIntInclusive(min, max) {
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }
  
    // 获取URL中的id参数
    function getUrlParam(name) {
      const reg = new RegExp(`(^|&)${name}=([^&]*)(&|$)`);
      const r = window.location.search.substr(1).match(reg);
      if (r != null) return decodeURIComponent(r[2]);
      return null;
    }

    // ========== 新增：阅读量统计核心函数 ==========
    // 1. 获取并更新阅读量（localStorage持久化存储）
    function updateReadCount(newsId) {
      // 定义localStorage的key前缀，避免与其他数据冲突
      const storageKey = `news_read_count_${newsId}`;
      
      try {
	      // 获取当前新闻对象
		const news = newsList.find(n => n.id === newsId);
    
		// 读取当前阅读量，不存在则使用news.pageCount作为初始值
		let count = localStorage.getItem(storageKey);
    
		if (count === null) {
			// 本地存储不存在，使用data.js中的pageCount作为初始值
			// 将pageCount转换为数字（如果是字符串的话）
			count = news && news.pageCount ? parseInt(news.pageCount) || 0 : 0;
		} else {
			count = parseInt(count);
		}
    
		// 阅读量随机增加[1,6]
		count = count + getRandomIntInclusive(1, 6);
    
		// 保存更新后的阅读量
		localStorage.setItem(storageKey, count);
		return count;

      } catch (e) {
        // 兼容localStorage不可用的情况（如隐私模式）
        console.warn("本地存储不可用，无法统计阅读量：", e);
        return "未知";
      }
    }

    // 2. 获取当前新闻的阅读量（仅读取，不增加）
    function getReadCount(newsId) {
		const storageKey = `news_read_count_${newsId}`;
  
		try {
			// 获取当前新闻对象
			const news = newsList.find(n => n.id === newsId);
    
			// 读取当前阅读量，不存在则使用news.pageCount作为初始值
			let count = localStorage.getItem(storageKey);
    
			if (count === null) {
				// 本地存储不存在，返回pageCount作为初始值
				return news && news.pageCount ? parseInt(news.pageCount) || 0 : 0;
			}
    
			return parseInt(count);
		} catch (e) {
			return "未知";
		}
    }

    // 渲染新闻详情
    function renderNewsDetail() {
      const newsId = parseInt(getUrlParam("id"));
      const news = newsList.find(n => n.id === newsId);
      
      const detailContainer = document.getElementById("newsDetail");
      const titleElement = document.getElementById("newsTitle");

      if (!news) {
        titleElement.textContent = "未找到该内容";
        detailContainer.innerHTML = '<div class="empty">抱歉，未找到对应的宣传内容</div>';
        return;
      }

      // ========== 新增：调用阅读量更新函数 ==========
      const readCount = updateReadCount(newsId);

      // 设置面包屑中的新闻标题
      titleElement.textContent = news.title.length > 20 ? news.title.substring(0, 20) + "..." : news.title;
      // 匹配所属公司
      const company = insuranceCompanies.find(c => c.id === news.companyId);
      const companyName = company ? company.name : "未知公司";

      // 渲染新闻详情
      let attachmentHtml = "";
      if (news.attachment) {
        // 提取附件名称
        const attachmentName = news.attachment.split("/").pop();
        attachmentHtml = `
          <div class="attachment">
            <strong>相关附件：</strong>
            <a href="${news.attachment}" download="${attachmentName}">${attachmentName}</a>
          </div>
        `;
      }

      // ========== 新增：在新闻信息栏添加阅读量展示 ==========
      detailContainer.innerHTML = `
        <h1 class="news-title">${news.title}</h1>
        <div class="news-info">
          <span>所属公司：<a href="company-detail.html?id=${company.id}" style="color: #0066cc;">${companyName}</a></span>
          <span>发布时间：${news.publishTime}</span>
          <!-- 阅读量展示：橙色加粗 -->
          <span class="read-count">阅读量：${readCount}</span>
          <br><br>
          <span class="coop-contact">${company.contact}</span>
        </div>
        <div class="news-content">
          ${news.content}
        </div>
        ${attachmentHtml}
      `;

      // 渲染相关推荐
      renderRelatedNews(news);
    }

    // 渲染相关推荐（同险种/同公司的其他新闻）
    function renderRelatedNews(currentNews) {
      // 筛选条件：同险种 或 同公司，排除当前新闻
      const related = newsList.filter(n => 
        (n.companyId === currentNews.companyId) && 
        n.id !== currentNews.id
      );
      // 最多展示3条
      const showRelated = related.slice(0, 3);

      const container = document.getElementById("relatedNews");
      if (showRelated.length === 0) {
        container.innerHTML = '<div class="empty">暂无相关宣传内容</div>';
        return;
      }

      let relatedHtml = "<h3>相关推荐</h3><div class='related-list'>";
      showRelated.forEach(news => {
        const company = insuranceCompanies.find(c => c.id === news.companyId);
        // ========== 新增：相关推荐也展示阅读量 ==========
        const relatedReadCount = getReadCount(news.id);
        relatedHtml += `
          <div class="related-item">
            <h4><a href="news-detail.html?id=${news.id}">${news.title}</a></h4>
            <div class="info">
              <span>所属公司：${company?.name || "未知"}</span> | 
              <span>发布时间：${news.publishTime}</span> |
              <!-- <span class="read-count">阅读量：${relatedReadCount}</span> -->
            </div>
          </div>
        `;
      });
      relatedHtml += "</div>";
      container.innerHTML = relatedHtml;
    }

    // 初始化页面
    renderNewsDetail();
  </script>
</body>

</html>
